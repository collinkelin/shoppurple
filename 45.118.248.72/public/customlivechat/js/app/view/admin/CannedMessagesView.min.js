!function(r,o,t){r.CannedMessagesView=Backbone.View.extend({events:{"click #customer-chat-canned-messages-back":"showList","click #customer-chat-canned-messages-add":"showAdd","click .customer-chat-canned-messages-edit":"showEdit","click .customer-chat-canned-messages-remove":"deleteMessage","click #customer-chat-canned-messages-save":"save"},initialize:function(){this.model=r.model.cannedMessages,this.user=r.model.user,this.$el.html(r.template.cannedMessages()),this.$list=this.$("#customer-chat-canned-messages-list"),this.$messages=this.$list.find(".customer-chat-content-messages-wrapper"),this.$edit=this.$("#customer-chat-canned-messages-edit"),this.$save=this.$("#customer-chat-canned-messages-save"),this.$back=this.$("#customer-chat-canned-messages-back"),this.$editInputs=this.$edit.find("input"),this.$loading=this.$(".customer-chat-content-loading-icon").hide(),this.$editInputs.blur(o.proxy(this.validateEdit,this)),this.model.on("change:messages",this.render,this),this.showList(),this.render()},render:function(){this.$messages.html("").append(t.map(this.model.get("messages"),function(e){return r.template.cannedMessageItem(e)}))},showList:function(){this.state="list",this.$edit.hide(),this.$list.show(),this.enable()},showEdit:function(e,s){this.state;this.state="edit",this.$edit.find(".add-only").hide(),this.$edit.find(".edit-only").show(),this.$edit.find(".customer-chat-input-error").removeClass("customer-chat-input-error");var t,i,a=e?o(e.currentTarget):null;t=a?a.data("id"):s,(i=r.model.selectedMessage=this.model.getById(t))&&(this.$edit.find("#messageNameField").val(i.name),this.$edit.find("#messageBodyField").val(i.body)),this.$list.hide(),this.$edit.show()},deleteMessage:function(e){var s=o(e.currentTarget),t=this.model.getById(s.data("id")),i=this,a={};a[r.service.i18n.trans("remove.msg").replace("%message%",t.name)]=function(){i.model.deleteMessage(t.id),o(this).dialog("close"),o(window).trigger("resize")},r.view.dialogs.confirm((r.service.i18n.trans("remove.msg")+"?").replace("%message%",t.name),r.service.i18n.trans("remove.msg.q"),a)},showAdd:function(){this.state="add",this.$edit.find(".customer-chat-tabs-header").html(r.service.i18n.trans("add.new.msg")),this.$edit.find(".edit-only, .pass-only").hide(),this.$edit.find(".add-only").show(),this.$edit.find(".customer-chat-input-error").removeClass("customer-chat-input-error"),r.model.selectedMessage={},this.$edit.find("#messageNameField").val(""),this.$edit.find("#messageBodyField").val(""),this.$list.hide(),this.$edit.show()},save:function(){if(this.isEditValid()&&!this.syncing){this.disable();var e=r.model.selectedMessage;if(e){e.name=this.$edit.find("#messageNameField").val(),e.body=this.$edit.find("#messageBodyField").val();var s=this;this.model.once("message:saved",function(e){s.enable(),s.showList()}),this.model.once("message:saveError",function(e){s.enable(),r.view.dialogs.formError(r.service.i18n.trans("form.error"),t.values(e))}),this.model.saveMessage(e)}else this.enable()}},disable:function(){this.syncing=!0,this.$save.addClass("button-disabled"),this.$loading.fadeIn()},enable:function(){var e=this;setTimeout(function(){e.$save.removeClass("button-disabled"),e.$loading.fadeOut(),e.syncing=!1,"add"==e.state&&e.showList()},500)},validateEdit:function(e,s){this.errors=!1;var d=this,t=s?this.$editInputs:o(e.target);if(!s){var i=o(e.target).data("validator-match");i&&(t=t.add(d.$el.find("#"+i)))}function n(e,s){if(e.addClass("customer-chat-input-error"),!1!==e.data("validator-msg")){var t=e.data("validator-label");t&&(s=t+": "+s),d.errors.push(s)}else d.errors.push(!1)}d.errors=[],t.each(function(){var e=o(this),s=e.data("validator-state"),t=e.data("validator-state-ex");if(!(s&&s!==d.state||t&&t===d.state)){switch(e.removeClass("customer-chat-input-error"),e.data("validator")){case"notEmpty":0==e.val().length&&n(e,r.service.i18n.trans("v.cant.be.empty"))}var i=e.data("validator-match");if(i){var a=d.$el.find("#"+i);e.val()!==a.val()&&n(e,r.service.i18n.trans("pass.have.to.match"))}}}),s&&0<this.errors.length&&r.view.dialogs.formError(r.service.i18n.trans("form.error"),this.errors)},isEditValid:function(){return this.validateEdit(null,!0),0===this.errors.length}})}(window.Application,jQuery,_,window.chatConfig);