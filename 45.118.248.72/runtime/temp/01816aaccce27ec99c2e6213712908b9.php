<?php /*a:2:{s:73:"/www/wwwroot/45.118.248.72/application/admin/view/deal/user_recharge.html";i:1592162113;s:59:"/www/wwwroot/45.118.248.72/application/admin/view/main.html";i:1593205496;}*/ ?>
<div class="layui-card layui-bg-gray"><?php if(!(empty($title) || (($title instanceof \think\Collection || $title instanceof \think\Paginator ) && $title->isEmpty()))): ?><div class="layui-card-header layui-anim layui-anim-fadein notselect"><span class="layui-icon layui-icon-next font-s10 color-desc margin-right-5"></span><?php echo htmlentities((isset($title) && ($title !== '')?$title:'')); ?><div class="pull-right"></div></div><?php endif; ?><div class="layui-card-body layui-anim layui-anim-upbit"><div class="think-box-shadow"><fieldset><legend>条件搜索</legend><form class="layui-form layui-form-pane form-search" action="<?php echo request()->url(); ?>" onsubmit="return false" method="get" autocomplete="off"><div class="layui-form-item layui-inline"><div class="layui-form-mid"><div class="layui-form-mid">订单号</div><div class="layui-input-inline"><input name="oid" value="<?php echo htmlentities((app('request')->get('oid') ?: '')); ?>" placeholder="请输入订单号" class="layui-input"></div></div><div class="layui-form-mid"><div class="layui-form-mid">用户名称</div><div class="layui-input-inline"><input name="username" value="<?php echo htmlentities((app('request')->get('username') ?: '')); ?>" placeholder="请输入用户名称" class="layui-input"></div></div><div class="layui-form-mid"><div class="layui-form-mid">手机号码</div><div class="layui-input-inline"><input name="tel" value="<?php echo htmlentities((app('request')->get('tel') ?: '')); ?>" placeholder="请输入手机号码" class="layui-input"></div></div><div class="layui-form-mid"><div class="layui-form-mid">名义人编号</div><div class="layui-input-inline"><input name="nominee" value="<?php echo htmlentities((app('request')->get('nominee') ?: '')); ?>" placeholder="请输入名义人编号" class="layui-input"></div></div><div class="layui-form-mid"><div class="layui-form-mid">顶级用户</div><div class="layui-input-inline"><input name="parent" value="<?php echo htmlentities((app('request')->get('parent') ?: '')); ?>" placeholder="请输入顶级用户名" class="layui-input"></div></div><div class="layui-form-mid"><div class="layui-form-mid">添加时间</div><div class="layui-input-inline"><input data-date-range name="addtime" value="<?php echo htmlentities((app('request')->get('addtime') ?: '')); ?>" placeholder="请选择添加时间" class="layui-input"></div></div><div class="layui-form-mid"><div class="layui-form-mid">订单状态</div><div class="layui-input-inline" style="width: 130px;"><select name="status"><option value="0" <?php if(empty(app('request')->get('status')) || ((app('request')->get('status') instanceof \think\Collection || app('request')->get('status') instanceof \think\Paginator ) && app('request')->get('status')->isEmpty())): ?>selected=""<?php endif; ?>>所有</option><option value="1" <?php if(app('request')->get('status') == '1'): ?>selected=""<?php endif; ?>>下单成功</option><option value="2" <?php if(app('request')->get('status') == '2'): ?>selected=""<?php endif; ?>>充值成功</option><option value="3" <?php if(app('request')->get('status') == '3'): ?>selected=""<?php endif; ?>>充值失败</option></select></div></div><div class="layui-form-mid"><div class="layui-form-mid">排序类型</div><div class="layui-input-inline" style="width: 130px;"><select name="sortKey"><option value="addtime" <?php if(app('request')->get('sortKey') == 'addtime'): ?>selected=""<?php endif; ?>>发起时间</option><option value="id" <?php if(app('request')->get('sortKey') == 'id'): ?>selected=""<?php endif; ?>>ID</option><option value="uid" <?php if(app('request')->get('sortKey') == 'uid'): ?>selected=""<?php endif; ?>>用户ID</option><option value="num" <?php if(app('request')->get('sortKey') == 'num'): ?>selected=""<?php endif; ?>>操作金额</option><option value="status" <?php if(app('request')->get('sortKey') == 'status'): ?>selected=""<?php endif; ?>>订单状态</option><option value="is_vip" <?php if(app('request')->get('sortKey') == 'is_vip'): ?>selected=""<?php endif; ?>>订单类型</option></select></div></div><div class="layui-form-mid"><div class="layui-form-mid">排序方法</div><div class="layui-input-inline" style="width: 130px;"><select name="sort"><option value="DESC" <?php if(app('request')->get('sort') == 'DESC'): ?>selected=""<?php endif; ?>>降序</option><option value="ASC" <?php if(app('request')->get('sort') == 'ASC'): ?>selected=""<?php endif; ?>>升序</option></select></div></div><div class="layui-form-mid"><button class="layui-btn layui-btn-primary"><i class="layui-icon">&#xe615;</i> 搜 索</button></div></div></form></fieldset><script>
    form.render()
    </script><fieldset>
        总额：<?php echo htmlentities($amount); ?></fieldset><table class="layui-table margin-top-15" lay-skin="line"><?php if(!(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty()))): ?><thead><tr><th class='text-left nowrap'>订单号</th><th class='text-left nowrap'>用户名</th><th class='text-left nowrap'>顶级用户</th><th class='text-left nowrap'>手机号</th><!-- <th class='text-left nowrap'>真实姓名</th> --><th class='text-left nowrap'>转账名义人</th><th class='text-left nowrap'>交易数额</th><th class='text-left nowrap'>打款凭证</th><th class='text-left nowrap'>添加时间</th><th class='text-left nowrap'>支付方式</th><th class='text-left nowrap'>类型</th><th class='text-left nowrap'>处理时间</th><th class='text-left nowrap'>操作</th></tr></thead><?php endif; ?><tbody><?php foreach($list as $key=>$vo): ?><tr><td class='text-left nowrap'><?php echo htmlentities($vo['id']); ?></td><td class='text-left nowrap'><a href="/admin.html#/admin/deal/user_recharge.html?spm=m-69-72-74&username=<?php echo htmlentities($vo['username']); ?>"><?php echo htmlentities($vo['username']); ?></a><a href="/admin.html#/admin/users/index.html?spm=m-62-63-64&username=<?php echo htmlentities($vo['username']); ?>">[查看用户]</a></td><td class='text-left nowrap'><?php if($vo['parent_first'] > 0): ?><a href="/admin.html#/admin/users/index.html?spm=m-62-63-64&username=<?php echo getUser($vo['parent_first'])['username']; ?>"><?php echo getUser($vo['parent_first'])['username']; ?></a><?php endif; if($vo['parent_first'] > 0): ?><a href="/admin.html#/admin/deal/user_recharge.html?spm=m-69-72-74&parent=<?php echo getUser($vo['parent_first'])['username']; ?>">[下线充值]</a><?php endif; ?></td><td class='text-left nowrap'><?php echo htmlentities($vo['tel']); ?></td><!-- <td class='text-left nowrap'><?php echo htmlentities($vo['real_name']); ?></td> --><td class='text-left nowrap'><?php echo htmlentities($vo['nominee'] . ' ' . $vo['real_name']); ?></td><td class='text-left nowrap'><?php echo htmlentities($vo['num']); ?></td><td class='text-left nowrap'><?php if($vo['pic']): ?><a data-dbclick data-title="查看图片" data-modal='<?php echo url("admin/index/picinfo"); ?>?pic=<?php echo htmlentities($vo['pic']); ?>'><img src="<?php echo htmlentities($vo['pic']); ?>" style="width:150px;height:100px;"></a><?php else: ?><img src="<?php echo htmlentities($vo['pic']); ?>" style="width:150px;height:100px;"><?php endif; ?></td><td class='text-left nowrap'><?php echo htmlentities(format_datetime($vo['addtime'])); ?></td><td class='text-left nowrap'><?php if($vo['pay_name']): ?><a data-dbclick data-modal='<?php echo url("admin/deal/viewpayinfo"); ?>?infoid=<?php echo htmlentities($vo['payinfo_id']); ?>'><?php echo htmlentities($vo['pay_name']); if($vo['bank_name']): ?>[<?php echo htmlentities($vo['bank_name']); ?>-<?php echo htmlentities($vo['card_number']); ?>]<?php endif; ?></a><?php else: ?>余额支付<?php endif; ?></td><td class='text-left nowrap'><?php if($vo['is_vip']): ?><button class="layui-btn layui-btn-xs layui-btn layui-btn-warm">会员升级</button><?php else: ?><button class="layui-btn layui-btn-xs layui-btn layui-btn-danger">会员充值</button><?php endif; ?></td><td class='text-left nowrap'><?php echo htmlentities(format_datetime($vo['endtime'])); ?></td><td class='text-left nowrap'><?php switch($vo['status']): case "0": ?>待付款<?php break; case "1": if(((auth("edit_recharge")) AND ($vo['pic']) AND ($vo['is_vip'] == 0)) OR ($vo['is_vip'] == 1)): ?><!-- <a data-csrf="<?php echo systoken('admin/deal/edit_recharge'); ?>" class="layui-btn layui-btn-xs layui-btn" data-action="<?php echo url('edit_recharge',['status'=>2,'id'=>$vo['id']]); ?>" data-value="id#<?php echo htmlentities($vo['id']); ?>;status#2">通过</a> --><a class="layui-btn layui-btn-xs layui-btn" onClick="agree('<?php echo htmlentities($vo['id']); ?>')">通过</a><a data-csrf="<?php echo systoken('admin/deal/edit_recharge'); ?>" class="layui-btn layui-btn-xs layui-btn-warm" data-modal="<?php echo url('edit_recharge'); ?>?id=<?php echo htmlentities($vo['id']); ?>">驳回</a><?php endif; break; case "2": ?>审核通过<?php break; case "3": ?>审核驳回<?php break; ?><?php endswitch; ?></td></tr><?php endforeach; ?></tbody></table><?php if(empty($list) || (($list instanceof \think\Collection || $list instanceof \think\Paginator ) && $list->isEmpty())): ?><span class="notdata">没有记录哦</span><?php else: ?><?php echo (isset($pagehtml) && ($pagehtml !== '')?$pagehtml:''); ?><?php endif; ?></div><script>
    function agree(id) {
        layer.confirm("确认要通过吗，通过后不能恢复", { title: "通过确认" }, function(index) {
            $.ajax({
                type: 'POST',
                url: "<?php echo url('edit_recharge'); ?>",
                data: {
                    'id': id,
                    'status': 2,
                },
                headers: {
                    'User-Token-Csrf': `<?php echo systoken('admin/deal/edit_recharge'); ?>` 
                },
                success: function(res) {
                    layer.msg(res.info, { time: 2500 });
                    location.reload();
                }
            });
        }, function() {});
    }
    </script></div></div>